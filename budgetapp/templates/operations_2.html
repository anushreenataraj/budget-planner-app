{% extends 'layouts.html'%}
{% block content_1%}
     <div class="content-section">
        <form  method="POST" enctype="multipart/form-data">
            {{ form.hidden_tag() }}
            <fieldset class="form-group mb-2">
              <h5 >Add File</h5>
                <div class="form-group">
                        {{ form.file(class="form-control form-control-lg") }}
                </div>
                 <div class="form-group">
                    {{ form.type_of_file.label(class="form-control-label") }}
                    {% if form.type_of_file.errors %}
                        {{ form.type_of_file(class="form-control form-control-lg is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form.type_of_file.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.type_of_file(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.month.label(class="form-control-label") }}
                    {% if form.month.errors %}
                        {{ form.month(class="form-control form-control-lg is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form.month.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.month(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form.year.label(class="form-control-label") }}
                    {% if form.year.errors %}
                        {{ form.year(class="form-control form-control-lg is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form.year.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.year(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
        </fieldset>
            <div class="form-group">
                {{ form.submit(class="btn btn-outline-info") }}
            </div>
        </form>
    </div>
  {% endblock content_1%} 
  {% block content%}
  <div class="content-section">
        <form  method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}
            <fieldset class="form-group mb-2">
                <div class="form-group">
                    {{ form.type_of_file.label(class="form-control-label") }}
                    {% if form.type_of_file.errors %}
                        {{ form.type_of_file(class="form-control form-control-lg is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form.type_of_file.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form.type_of_file(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form_1.mode.label(class="form-control-label") }}
                    {% if form_1.mode.errors %}
                        {{ form_1.mode(class="form-control form-control-lg is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form_1.mode.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form_1.mode(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form_1.month.label(class="form-control-label") }}
                    {% if form_1.month.errors %}
                        {{ form_1.month(class="form-control form-control-lg is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form_1.month.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form_1.month(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                <div class="form-group">
                    {{ form_1.year.label(class="form-control-label") }}
                    {% if form_1.year.errors %}
                        {{ form_1.year(class="form-control form-control-lg is-invalid") }}
                        <div class="invalid-feedback">
                            {% for error in form_1.year.errors %}
                                <span>{{ error }}</span>
                            {% endfor %}
                        </div>
                    {% else %}
                        {{ form_1.year(class="form-control form-control-lg") }}
                    {% endif %}
                </div>
                </fieldset>
            <div class="form-group">
                {{ form_1.submit1(class="btn btn-outline-info") }}
            </div>
        </form>
    </div>
    {% if exp %}
        {%if k%}
        <h3 style="text-Align:Center;font-weight:bold;margin-top:50px;">Data Insights</h3>
        {%for i in k%}
        <h5>{{i}}</h5>
            <section id="minimal-statistics">
              <div class="row">
                {%for j in k[i] %}
                  <div class="col-xl-3 col-sm-6 col-12"> 
                    <div class="card">
                      <div class="card-content">
                        <div class="card-body">
                          <div class="media d-flex" >
                            <div class="align-self-center" ><i class="icon-{{j[2]}}  primary font-large-2 float-left"></i></div>
                            <div class="media-body text-right" ><h3 style="font-weight:bold;">{{j[1]}}</h3><span>{{j[0]}}</span></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                {%endfor%}
              </div>
            </section>
        {%endfor%}
      {%endif%}
      <h3 style="text-Align:Center;font-weight:bold;margin-top:50px;">Comparision Analysis</h3>
          {% if d%}
          {%for k in d%}
          <div class="row">
            {%for i in d[k] %}
						<div class="col-12 col-sm-6 col-xxl d-flex">
							<div class="card flex-fill">
								<div class="card-body">
									<div class="d-flex align-items-start">
										<div class="flex-grow-1">
                      <h class="mb-2">{{k}}</h>
											<h3 class="mb-2">{{i[0]}}</h3>
											<p class="mb-2">{{i[1]}}</p>
											<div class="mb-0">
												<span class="badge badge-soft-{{i[3]}} me-2"> <i class="mdi mdi-arrow-bottom-right"></i>{{i[2]}}</span>
												<span class="text-muted">{{i[4]}}</span>
											</div>
										</div>
										<div class="d-inline-block ms-3">
											<div class="stat">
												<svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="24" height="24" viewBox="0 0 226 226" style=" fill:#000000;"><g fill="none" fill-rule="nonzero" stroke="none" stroke-width="1" stroke-linecap="butt" stroke-linejoin="miter" stroke-miterlimit="10" stroke-dasharray="" stroke-dashoffset="0" font-family="none" font-weight="none" font-size="none" text-anchor="none" style="mix-blend-mode: normal"><path d="M0,226v-226h226v226z" fill="none"></path><g fill="#df0e62"><path d="M135.487,47.08333h28.12758l5.88542,-18.83333h-107.11458l-5.88542,18.83333h37.66667c14.47342,0 26.63033,9.38842 31.06558,22.36458h-62.84683l-5.88542,18.83333h69.45733c-3.6725,14.19092 -16.45092,24.71875 -31.79067,24.71875h-37.66667v14.464l69.44792,70.286h24.71875v-2.35417l-65.91667,-65.91667c5.78183,0 12.64658,0 14.125,0c24.48333,0 44.66325,-17.83517 48.60883,-41.19792h16.13075l5.88542,-18.83333h-22.39283c-1.85508,-8.51267 -5.99842,-16.11192 -11.62017,-22.36458z"></path></g></g></svg>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
            {%endfor%}
					</div>
          {%endfor%}
          {%endif%}
    <h3 style="text-Align:Center;font-weight:bold;margin-top:50px;">Visualization</h3>
        <div class="out">
    <div class="in"><h4>{{u[1]}}</h4><canvas class="pie" id="myChart_o_2"></canvas></div>
    <div class="tab">
        {% set l = labels.split(',') %}
          <table class="tab_1">
          {%for i in range(exp|length)%}
            {%if u[i]=="Category"%}
              <tr>
                <th>{{u[i]}}</th>
                <th>{{u[i+1]}}</th>
              </tr>
            {%elif u[i]=="category"%}
              <tr>
                <th>{{u[i]}}</th>
                <th>{{u[i+1]}}</th>
              </tr>
            {%else%}
              <tr>
                <td>{{l[i]}}</td>
                <td>{{exp[i]}}</td>
              </tr>
            {%endif%}
          {%endfor%}
          </table>
        </div>
    </div>
        <script>
          var j='{{labels}}'
          var lab= j.split(',')
          function calculatePoint(i, intervalSize, colorRangeInfo) {
            var { colorStart, colorEnd, useEndAsStart } = colorRangeInfo;
            return (useEndAsStart
              ? (colorEnd - (i * intervalSize)): (colorStart + (i * intervalSize)));
          }
          function interpolateColors(dataLength,colorRangeInfo) {
            var { colorStart, colorEnd } = colorRangeInfo;
            var colorRange = colorEnd - colorStart;
            var intervalSize = colorRange / dataLength;
            var i, colorPoint;
            var colorArray = [];
            for (i = 0; i < dataLength; i++) {
            colorPoint = calculatePoint(i, intervalSize, colorRangeInfo);
            colorArray.push(d3.interpolateSpectral(colorPoint));
            }
            return colorArray;
          }  
          const colorRangeInfo = {
            colorStart: 0,
            colorEnd: 1,
            useEndAsStart: false,
          }
          var myData={{exp}}
          var COLORS = interpolateColors(myData.length,colorRangeInfo);
          const data = {
            labels: lab,
            datasets: [{
              label: 'My First Dataset',
              data: {{exp}},
              backgroundColor: COLORS,
              hoverBackgroundColor: COLORS,
              hoverOffset: 4
            }]
          };
          const config = {
            type: 'pie',
            data: data,
          };
          var myChart = new Chart(
            document.getElementById('myChart_o_2'),
            config
          );
        </script>

         <div class="out">
        <div class="in" ><h4>{{u[2]}}</h4><canvas class="pie" id="myChart1_o_2"></canvas></div>
        <div class="tab">
        {% set l = labels.split(',') %}
          <table class="tab_1">
          {%for i in range(exp|length)%}
            {%if u[i]=="Category"%}
              <tr>
                <th>{{u[i]}}</th>
                <th>{{u[i+2]}}</th>
              </tr>
            {%elif u[i]=="category"%}
              <tr>
                <th>{{u[i]}}</th>
                <th>{{u[i+2]}}</th>
              </tr>
            {%else%}
              <tr>
                <td>{{l[i]}}</td>
                 <td>{{rev[i]}}</td>
              </tr>
            {%endif%}
          {%endfor%}
          </table>
        </div>
        </div>
        <script>
        var myData_1={{rev}}
          var COLORS_1 = interpolateColors(myData_1.length,colorRangeInfo);
          const data_1 = {
            labels: lab,
            datasets: [{
              label: 'My First Dataset',
              data: {{rev}},
              backgroundColor: COLORS_1,
              hoverBackgroundColor: COLORS_1,
              hoverOffset: 4
            }]
          };
          const config_1 = {
            type: 'pie',
            data: data_1,
          };
          var myChart_1 = new Chart(
            document.getElementById('myChart1_o_2'),
            config_1
          );
        </script>
        <h4 >Expenses vs Revenue</h4>
        <div class="bar" >
        <canvas id="barchart_o_2"></canvas>
        </div>
        <script>
          function clr(l,len){
            var a=[];
            for(var i=0;i<len;i++){
              a.push(l)
            }
            return a
          }
          const data1 = {
            labels: lab,
            datasets: [{
              label: 'Expenses',
              data: {{exp}},
              backgroundColor: clr('rgba(255, 99, 132, 0.2)',{{exp}}.length),
              borderColor: clr('rgb(255, 99, 132)',{{exp}}.length),
              borderWidth: 1
            },{
              label: 'Revenue',
              data:{{rev}},
              backgroundColor: clr('rgba(54, 162, 235, 0.2)',{{rev}}.length),
              borderColor: clr('rgb(54, 162, 235)',{{rev}}.length),
              borderWidth: 1
            }]
          };
          const config1 = {
            type: 'bar',
            data: data1,
            options: {
              scales: {
                x: {
                  stacked: true
                },
                y: {
                  stacked: true
                }
              }
            }
          };
          var myChart = new Chart(document.getElementById('barchart_o_2'),config1);
        </script>
    {% endif %}
    {%if expense%}
    <h3 style="text-Align:Center;font-weight:bold;margin-top:50px;">Visualization</h3>
<div class="line"><h5>Periodic Analysis</h5><canvas id="lineChart_o_2"></canvas></div>
<script>
var j='{{labels}}'
var lab= j.split(',')
function clr(l,len){
    var a=[];
    for(var i=0;i<len;i++){
        a.push(l)
    }
    return a
}
const data = {
  labels: lab,
  datasets: [
    {
      label: 'Total Expenses',
      data: {{expense}},
      borderColor: clr('rgba(255, 99, 132, 0.2)',{{expense}}.length),
      backgroundColor: clr('rgb(255, 99, 132)',{{expense}}.length)
    },
    {
      label: 'Total Revenue',
      data: {{revenue}},
      borderColor: clr('rgba(54, 162, 235, 0.2)',{{revenue}}.length),
      backgroundColor: clr('rgb(54, 162, 235)',{{revenue}}.length)
    }
  ]
};
const config = {
  type: 'line',
  data: data,
  options: {
    responsive: true,
    plugins: {
      legend: {
        position: 'top',
      }
    }
  },
};
var myChart_1 = new Chart(
    document.getElementById('lineChart_o_2'),
    config
);
</script>
{%endif%}
{% endblock content%} 